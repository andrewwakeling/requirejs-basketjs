/*!
* basket.js
* v0.4.0 - 2014-01-07
* http://addyosmani.github.com/basket.js
* (c) Addy Osmani;  License
* Created by: Addy Osmani, Sindre Sorhus, AndrÃ©e Hansson, Mat Scales
* Contributors: Ironsjp, Mathias Bynens, Rick Waldron, Felipe Morais
* Uses rsvp.js, https://github.com/tildeio/rsvp.js
*/
!function(a){var b,c,d,e;!function(){var a={},f={};b=function(b,c,d){a[b]={deps:c,callback:d}},e=d=c=function(b){function d(a){if("."!==a.charAt(0))return a;for(var c=a.split("/"),d=b.split("/").slice(0,-1),e=0,f=c.length;f>e;e++){var g=c[e];if(".."===g)d.pop();else{if("."===g)continue;d.push(g)}}return d.join("/")}if(e._eak_seen=a,f[b])return f[b];if(f[b]={},!a[b])throw new Error("Could not find module "+b);for(var g,h=a[b],i=h.deps,j=h.callback,k=[],l=0,m=i.length;m>l;l++)"exports"===i[l]?k.push(g={}):k.push(c(d(i[l])));var n=j.apply(this,k);return f[b]=g||n}}(),b("rsvp/all",["./promise","exports"],function(a,b){"use strict";var c=a["default"];b["default"]=function(a,b){return c.all(a,b)}}),b("rsvp/asap",["exports"],function(a){"use strict";function b(){return function(){process.nextTick(e)}}function c(){var a=0,b=new h(e),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function d(){return function(){setTimeout(e,1)}}function e(){for(var a=0;a<i.length;a++){var b=i[a],c=b[0],d=b[1];c(d)}i=[]}a["default"]=function(a,b){var c=i.push([a,b]);1===c&&f()};var f,g="undefined"!=typeof window?window:{},h=g.MutationObserver||g.WebKitMutationObserver,i=[];f="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?b():h?c():d()}),b("rsvp/config",["./events","exports"],function(a,b){"use strict";function c(a,b){return"onerror"===a?(e.on("error",b),void 0):2!==arguments.length?e[a]:(e[a]=b,void 0)}var d=a["default"],e={instrument:!1};d.mixin(e),b.config=e,b.configure=c}),b("rsvp/defer",["./promise","exports"],function(a,b){"use strict";var c=a["default"];b["default"]=function(a){var b={};return b.promise=new c(function(a,c){b.resolve=a,b.reject=c},a),b}}),b("rsvp/events",["exports"],function(a){"use strict";var b=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},c=function(a){var b=a._promiseCallbacks;return b||(b=a._promiseCallbacks={}),b};a["default"]={mixin:function(a){return a.on=this.on,a.off=this.off,a.trigger=this.trigger,a._promiseCallbacks=void 0,a},on:function(a,d){var e,f=c(this);e=f[a],e||(e=f[a]=[]),-1===b(e,d)&&e.push(d)},off:function(a,d){var e,f,g=c(this);return d?(e=g[a],f=b(e,d),-1!==f&&e.splice(f,1),void 0):(g[a]=[],void 0)},trigger:function(a,b){var d,e,f=c(this);if(d=f[a])for(var g=0;g<d.length;g++)(e=d[g])(b)}}}),b("rsvp/filter",["./all","./map","./utils","exports"],function(a,b,c,d){"use strict";function e(a,b,c){if(!i(a))throw new TypeError("You must pass an array to filter.");if(!h(b))throw new TypeError("You must pass a function to filter's second argument.");return f(a,c).then(function(d){return g(a,b,c).then(function(a){var b,c=d.length,e=[];for(b=0;c>b;b++)a[b]&&e.push(d[b]);return e})})}var f=a["default"],g=b["default"],h=c.isFunction,i=c.isArray;d["default"]=e}),b("rsvp/hash",["./promise","./utils","exports"],function(a,b,c){"use strict";var d=a["default"],e=b.isNonThenable,f=b.keysOf;c["default"]=function(a){return new d(function(b,c){function g(a){return function(c){k[a]=c,0===--m&&b(k)}}function h(a){m=0,c(a)}var i,j,k={},l=f(a),m=l.length;if(0===m)return b(k),void 0;for(var n=0;n<l.length;n++)j=l[n],i=a[j],e(i)?(k[j]=i,0===--m&&b(k)):d.cast(i).then(g(j),h)})}}),b("rsvp/instrument",["./config","./utils","exports"],function(a,b,c){"use strict";var d=a.config,e=b.now;c["default"]=function(a,b,c){try{d.trigger(a,{guid:b._guidKey+b._id,eventName:a,detail:b._detail,childGuid:c&&b._guidKey+c._id,label:b._label,timeStamp:e(),stack:new Error(b._label).stack})}catch(f){setTimeout(function(){throw f},0)}}}),b("rsvp/map",["./promise","./all","./utils","exports"],function(a,b,c,d){"use strict";var e=(a["default"],b["default"]),f=c.isArray,g=c.isFunction;d["default"]=function(a,b,c){if(!f(a))throw new TypeError("You must pass an array to map.");if(!g(b))throw new TypeError("You must pass a function to map's second argument.");return e(a,c).then(function(a){var d,f=a.length,g=[];for(d=0;f>d;d++)g.push(b(a[d]));return e(g,c)})}}),b("rsvp/node",["./promise","exports"],function(a,b){"use strict";function c(a,b){return function(c,d){c?b(c):arguments.length>2?a(e.call(arguments,1)):a(d)}}var d=a["default"],e=Array.prototype.slice;b["default"]=function(a,b){return function(){var f=e.call(arguments),g=this||b;return new d(function(b,e){d.all(f).then(function(d){try{d.push(c(b,e)),a.apply(g,d)}catch(f){e(f)}})})}}}),b("rsvp/promise",["./config","./events","./instrument","./utils","./promise/cast","./promise/all","./promise/race","./promise/resolve","./promise/reject","exports"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(){}function l(a,b){if(!z(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof l))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._id=H++,this._label=b,this._subscribers=[],w.instrument&&x("created",this),k!==a&&m(a,this)}function m(a,b){function c(a){r(b,a)}function d(a){t(b,a)}try{a(c,d)}catch(e){d(e)}}function n(a,b,c,d){var e=a._subscribers,f=e.length;e[f]=b,e[f+K]=c,e[f+L]=d}function o(a,b){var c,d,e=a._subscribers,f=a._detail;w.instrument&&x(b===K?"fulfilled":"rejected",a);for(var g=0;g<e.length;g+=3)c=e[g],d=e[g+b],p(b,c,d,f);a._subscribers=null}function p(a,b,c,d){var e,f,g,h,i=z(c);if(i)try{e=c(d),g=!0}catch(j){h=!0,f=j}else e=d,g=!0;q(b,e)||(i&&g?r(b,e):h?t(b,f):a===K?r(b,e):a===L&&t(b,e))}function q(a,b){var c,d=null;try{if(a===b)throw new TypeError("A promises callback cannot return that same promise.");if(y(b)&&(d=b.then,z(d)))return d.call(b,function(d){return c?!0:(c=!0,b!==d?r(a,d):s(a,d),void 0)},function(b){return c?!0:(c=!0,t(a,b),void 0)},"derived from: "+(a._label||" unknown promise")),!0}catch(e){return c?!0:(t(a,e),!0)}return!1}function r(a,b){a===b?s(a,b):q(a,b)||s(a,b)}function s(a,b){a._state===I&&(a._state=J,a._detail=b,w.async(u,a))}function t(a,b){a._state===I&&(a._state=J,a._detail=b,w.async(v,a))}function u(a){o(a,a._state=K)}function v(a){a._onerror&&a._onerror(a._detail),o(a,a._state=L)}var w=a.config,x=(b["default"],c["default"]),y=d.objectOrFunction,z=d.isFunction,A=d.now,B=e["default"],C=f["default"],D=g["default"],E=h["default"],F=i["default"],G="rsvp_"+A()+"-",H=0;j["default"]=l,l.cast=B,l.all=C,l.race=D,l.resolve=E,l.reject=F;var I=void 0,J=0,K=1,L=2;l.prototype={constructor:l,_id:void 0,_guidKey:G,_label:void 0,_state:void 0,_detail:void 0,_subscribers:void 0,_onerror:function(a){w.trigger("error",a)},then:function(a,b,c){var d=this;this._onerror=null;var e=new this.constructor(k,c);if(this._state){var f=arguments;w.async(function(){p(d._state,e,f[d._state-1],d._detail)})}else n(this,e,a,b);return w.instrument&&x("chained",d,e),e},"catch":function(a,b){return this.then(null,a,b)},"finally":function(a,b){var c=this.constructor;return this.then(function(b){return c.cast(a()).then(function(){return b})},function(b){return c.cast(a()).then(function(){throw b})},b)}}}),b("rsvp/promise/all",["../utils","exports"],function(a,b){"use strict";var c=a.isArray,d=a.isNonThenable;b["default"]=function(a,b){if(!c(a))throw new TypeError("You must pass an array to all.");var e=this;return new e(function(b,c){function f(a){return function(c){j[a]=c,0===--i&&b(j)}}function g(a){i=0,c(a)}var h,i=a.length,j=new Array(i);if(0===i)return b(j),void 0;for(var k=0;k<a.length;k++)h=a[k],d(h)?(j[k]=h,0===--i&&b(j)):e.cast(h).then(f(k),g)},b)}}),b("rsvp/promise/cast",["exports"],function(a){"use strict";a["default"]=function(a){var b=this;return a&&"object"==typeof a&&a.constructor===b?a:new b(function(b){b(a)})}}),b("rsvp/promise/race",["../utils","exports"],function(a,b){"use strict";var c=a.isArray,d=(a.isFunction,a.isNonThenable);b["default"]=function(a,b){if(!c(a))throw new TypeError("You must pass an array to race.");var e,f=this;return new f(function(b,c){function g(a){i&&(i=!1,b(a))}function h(a){i&&(i=!1,c(a))}for(var i=!0,j=0;j<a.length;j++){if(e=a[j],d(e))return i=!1,b(e),void 0;f.cast(e).then(g,h)}},b)}}),b("rsvp/promise/reject",["exports"],function(a){"use strict";a["default"]=function(a,b){var c=this;return new c(function(b,c){c(a)},b)}}),b("rsvp/promise/resolve",["exports"],function(a){"use strict";a["default"]=function(a,b){var c=this;return new c(function(b){b(a)},b)}}),b("rsvp/race",["./promise","exports"],function(a,b){"use strict";var c=a["default"];b["default"]=function(a,b){return c.race(a,b)}}),b("rsvp/reject",["./promise","exports"],function(a,b){"use strict";var c=a["default"];b["default"]=function(a,b){return c.reject(a,b)}}),b("rsvp/resolve",["./promise","exports"],function(a,b){"use strict";var c=a["default"];b["default"]=function(a,b){return c.resolve(a,b)}}),b("rsvp/rethrow",["exports"],function(a){"use strict";a["default"]=function(a){throw setTimeout(function(){throw a}),a}}),b("rsvp/utils",["exports"],function(a){"use strict";function b(a){return"function"==typeof a||"object"==typeof a&&null!==a}function c(a){return"function"==typeof a}function d(a){return!b(a)}function e(a){return"[object Array]"===Object.prototype.toString.call(a)}a.objectOrFunction=b,a.isFunction=c,a.isNonThenable=d,a.isArray=e;var f=Date.now||function(){return(new Date).getTime()};a.now=f;var g=Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b};a.keysOf=g}),b("rsvp",["./rsvp/promise","./rsvp/events","./rsvp/node","./rsvp/all","./rsvp/race","./rsvp/hash","./rsvp/rethrow","./rsvp/defer","./rsvp/config","./rsvp/map","./rsvp/resolve","./rsvp/reject","./rsvp/asap","./rsvp/filter","exports"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(a,b){A.async(a,b)}function q(){A.on.apply(A,arguments)}function r(){A.off.apply(A,arguments)}var s=a["default"],t=b["default"],u=c["default"],v=d["default"],w=e["default"],x=f["default"],y=g["default"],z=h["default"],A=i.config,B=i.configure,C=j["default"],D=k["default"],E=l["default"],F=m["default"],G=n["default"];if(A.async=F,"undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var H=window.__PROMISE_INSTRUMENTATION__;B("instrument",!0);for(var I in H)H.hasOwnProperty(I)&&q(I,H[I])}o.Promise=s,o.EventTarget=t,o.all=v,o.race=w,o.hash=x,o.rethrow=y,o.defer=z,o.denodeify=u,o.configure=B,o.on=q,o.off=r,o.resolve=D,o.reject=E,o.async=p,o.map=C,o.filter=G}),a.RSVP=c("rsvp")}(window),function(a,b){"use strict";var c=b.head||b.getElementsByTagName("head")[0],d="basket-",e=5e3,f=function(a,b){try{return localStorage.setItem(d+a,JSON.stringify(b)),!0}catch(c){if(c.name.toUpperCase().indexOf("QUOTA")>=0){var e,g=[];for(e in localStorage)0===e.indexOf(d)&&g.push(JSON.parse(localStorage[e]));return g.length?(g.sort(function(a,b){return a.stamp-b.stamp}),basket.remove(g[0].key),f(a,b)):void 0}return}},g=function(a){var b=new RSVP.Promise(function(b,c){var d=new XMLHttpRequest;d.open("GET",a),d.onreadystatechange=function(){4===d.readyState&&(200===d.status?b({content:d.responseText,type:d.getResponseHeader("content-type")}):c(new Error(d.statusText)))},d.send()});return b},h=function(a){return g(a.url).then(function(b){var c=i(a,b);return f(a.key,c),c})},i=function(a,b){var c=+new Date;return a.data=b.content,a.originalType=b.type,a.type=a.type||b.type,a.stamp=c,a.expire=c+60*(a.expire||e)*60*1e3,a},j=function(a,b){return!a||a.expire-+new Date<0||b.unique!==a.unique||basket.isValidItem&&!basket.isValidItem(a,b)},k=function(a){var b,c,d;if(a.url)return a.key=a.key||a.url,b=basket.get(a.key),a.execute=a.execute!==!1,d=j(b,a),a.live||d?(a.unique&&(a.url+=(a.url.indexOf("?")>0?"&":"?")+"basket-unique="+a.unique),c=h(a),a.live&&!d&&(c=c.then(function(a){return a},function(){return b}))):(b.type=a.type||b.originalType,c=new RSVP.Promise(function(a){a(b)})),c},l=function(a){var d=b.createElement("script");d.defer=!0,d.text=a.data,c.appendChild(d)},m={"default":l},n=function(a){return a.type&&m[a.type]?m[a.type](a):m["default"](a)},o=function(a){a.map(function(a){return a.execute&&n(a),a})},p=function(){var a,b,c=[];for(a=0,b=arguments.length;b>a;a++)c.push(k(arguments[a]));return RSVP.all(c)},q=function(){var a=p.apply(null,arguments),b=this.then(function(){return a}).then(o);return b.thenRequire=q,b};a.basket={require:function(){var a=p.apply(null,arguments).then(o);return a.thenRequire=q,a},remove:function(a){return localStorage.removeItem(d+a),this},get:function(a){var b=localStorage.getItem(d+a);try{return JSON.parse(b||"false")}catch(c){return!1}},clear:function(a){var b,c,e=+new Date;for(b in localStorage)c=b.split(d)[1],c&&(!a||this.get(c).expire<=e)&&this.remove(c);return this},isValidItem:null,timeout:5e3,addHandler:function(a,b){Array.isArray(a)||(a=[a]),a.forEach(function(a){m[a]=b})},removeHandler:function(a){basket.addHandler(a,void 0)}},basket.clear(!0)}(this,document);
//# sourceMappingURL=dist/basket.full.map